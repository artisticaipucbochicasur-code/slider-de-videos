<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Videos y Comentarios</title>
  <script>
    // URL de tu servicio Apps Script (ajustar con la URL de tu script desplegado)
    const url = 'https://script.google.com/macros/s/AKfycbwBDSHfHj6FXyGGEsDjjJH0FgHk_G8sdG7OSRtA/exec';

    // Función para listar videos
    function listarVideos() {
      fetch(url + '?accion=listarWeb', {
        method: 'GET'
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            const container = document.getElementById('videos-container');
            container.innerHTML = ''; // Limpiar contenedor
            data.publicaciones.forEach(video => {
              const div = document.createElement('div');
              div.innerHTML = `<h3>${video.titulo}</h3><a href="${video.link}" target="_blank">Ver Video</a>`;
              container.appendChild(div);
            });
          }
        })
        .catch(err => console.log('Error al listar videos:', err));
    }

    // Función para agregar un comentario a un video
    function agregarComentario() {
      const videoId = document.getElementById('videoId').value;
      const comentario = document.getElementById('comentario').value;
      const autor = document.getElementById('autor').value;
      const correo = document.getElementById('correo').value;

      fetch(url + '?accion=agregarComentarioVideo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          videoId: videoId,
          comentario: comentario,
          autor: autor,
          correo: correo
        })
      })
        .then(response => response.json())
        .then(data => {
          alert(data.message);
          listarComentarios(videoId); // Listar comentarios después de agregar uno
        })
        .catch(err => console.log('Error al agregar comentario:', err));
    }

    // Función para listar comentarios de un video
    function listarComentarios(videoId) {
      fetch(url + '?accion=listarComentarios&videoId=' + videoId, {
        method: 'GET'
      })
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('comentarios-container');
          container.innerHTML = ''; // Limpiar contenedor de comentarios
          data.data.forEach(comentario => {
            const div = document.createElement('div');
            div.innerHTML = `<p><strong>${comentario.autor}</strong>: ${comentario.comentario}</p>`;
            container.appendChild(div);
          });
        })
        .catch(err => console.log('Error al listar comentarios:', err));
    }

    // Función para eliminar un comentario
    function eliminarComentario() {
      const videoId = document.getElementById('videoId').value;
      const comentario = document.getElementById('comentarioEliminar').value;
      const correo = document.getElementById('correoEliminar').value;

      fetch(url + '?accion=eliminarComentario', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          videoId: videoId,
          comentario: comentario,
          correo: correo
        })
      })
        .then(response => response.json())
        .then(data => {
          alert(data.message);
          listarComentarios(videoId); // Listar comentarios después de eliminar uno
        })
        .catch(err => console.log('Error al eliminar comentario:', err));
    }

    // Llamada inicial para listar los videos
    window.onload = function() {
      listarVideos();
    };
  </script>
</head>
<body>

  <h1>Videos y Comentarios</h1>

  <!-- Contenedor de videos -->
  <div id="videos-container">
    <h2>Videos:</h2>
    <!-- Los videos se listarán aquí -->
  </div>

  <hr>

  <!-- Formulario para agregar comentario -->
  <h2>Agregar Comentario a un Video</h2>
  <form onsubmit="agregarComentario(); return false;">
    <label for="videoId">ID del Video:</label>
    <input type="text" id="videoId" required><br><br>

    <label for="comentario">Comentario:</label>
    <textarea id="comentario" required></textarea><br><br>

    <label for="autor">Autor:</label>
    <input type="text" id="autor" required><br><br>

    <label for="correo">Correo:</label>
    <input type="email" id="correo" required><br><br>

    <button type="submit">Agregar Comentario</button>
  </form>

  <hr>

  <!-- Formulario para eliminar comentario -->
  <h2>Eliminar Comentario de un Video</h2>
  <form onsubmit="eliminarComentario(); return false;">
    <label for="videoId">ID del Video:</label>
    <input type="text" id="videoIdEliminar" required><br><br>

    <label for="comentarioEliminar">Comentario a Eliminar:</label>
    <input type="text" id="comentarioEliminar" required><br><br>

    <label for="correoEliminar">Correo del Autor:</label>
    <input type="email" id="correoEliminar" required><br><br>

    <button type="submit">Eliminar Comentario</button>
  </form>

  <hr>

  <!-- Contenedor de comentarios -->
  <div id="comentarios-container">
    <h2>Comentarios:</h2>
    <!-- Los comentarios de un video se listarán aquí -->
  </div>

</body>
</html>
