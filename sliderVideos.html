<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PWA y Iconos para Android e iOS -->
    <link rel="manifest" href="manifest.json">

    <!-- Iconos para Android (Chrome) -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

    <!-- Meta tags para iOS (Safari) -->
    <link rel="apple-touch-icon" href="apple-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DECOM">

    <!-- Meta para color de barra de estado en Android/iOS -->
    <meta name="theme-color" content="#111111">

    <meta name="mobile-web-app-capable" content="yes">

    <title>DECOM - Videos</title> <!-- Título específico para evitar que la URL se use como título implícito -->

    <style>
        /* ... (tu CSS existente) ... */
        #socialHeader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 10001;
            padding: 8px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            opacity: 1 !important; /* Forzar visibilidad */
            pointer-events: auto !important; /* Asegurar interacción */
        }
        /* ... (resto de tu CSS) ... */
    </style>
</head>
    <style>

        :root {
            --bg1: #000;
            --bg2: #000;
            --text: #fff;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg1), var(--bg2));
            font-family: "Segoe UI", Arial, sans-serif;
            color: var(--text);
            overflow: hidden;
        }

   /* Botones flotantes */
.floating-buttons {
    position: fixed;
    bottom: 90px;
    right: 18px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 2000;
}
.fab {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
    color: white;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
.fab.danger {}
.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 10px;
}
.modal-actions button {
    flex: 1;
}

/* Modal */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
}
.modal.hidden { display: none; }
.modal-content {
    background: #111;
    padding: 20px;
    border-radius: 10px;
    width: 300px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    color: #fff;
}
.modal-content input { padding: 6px; }

/* Progreso flotante */
.progress-toast {
    position: fixed;
    top: 15px;
    right: 15px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 10px 14px;
    border-radius: 6px;
    z-index: 4000;
    width: 200px;
}
.progress-toast.hidden { display: none; }
.progress-toast .bar {
    height: 4px;
    background: #28a745;
    width: 0%;
    margin-bottom: 6px;
    transition: width 0.3s ease;
}

.swiper {
    width: 100vw;
    height: 100vh;
    position: relative;
}

.swiper-slide {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: stretch;
    position: relative;
    background: #000;
}

.player-card {
    position: relative;
    width: 100%;
    height: 100vh;
    background: #000;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    border-radius: 10px;
}

.poster {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #111;
    background-size: cover;
    background-position: center center;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
}

.play-btn {
    display: grid;
    place-items: center;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(2px);
    font-size: 28px;
    line-height: 1;
    border: 2px solid #fff;
}

.player-iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
    background: #000;
}

/* Truncamiento para el contenedor del título y la descripción */
#video-title-fixed .text-container {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2; /* Truncar a 2 líneas por defecto */
    transition: -webkit-line-clamp 0.3s ease;
    cursor: pointer;
    position: relative;
    max-height: 4em;
    line-height: 1.2;
}

#video-title-fixed .text-container.expanded {
    -webkit-line-clamp: unset;
    cursor: pointer;
    overflow-y: auto;
    max-height: 60vh;
    padding-right: 15px;
}

#video-title-fixed .toggle-text {
    color: #ccc;
    font-size: 12px;
    font-weight: bold;
    user-select: none;
    display: inline-block;
    margin-left: 6px;
    cursor: pointer;
    background: none !important; /* 👈 sin fondo */
    padding: 0;
}


#video-title-fixed {
    position: absolute;
    top: 60px; /* Bajado para estar debajo del encabezado */
    left: 0; /* alineado a la izquierda */
    width: 100%; /* ocupa todo el ancho */
    max-width: 100%; /* no limitar */
    z-index: 1000;
    background: rgba(0,0,0,0.3);
    transition: opacity 0.18s ease;
    opacity: 1;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 6px 10px;
    margin: 0;
    border-bottom-left-radius: 6px; /* 👌 opcional */
    border-bottom-right-radius: 6px; /* 👌 opcional */
}




#video-title-fixed .video-title {
    font-size: 18px;
    font-weight: 600;
    text-align: left;
    color: #f1f1f1;
}

#video-title-fixed .video-desc {
    font-size: 14px;
    opacity: 0.85;
    text-align: left;
    color: #ddd;
}

/* 🔔 Notificaciones */
#notification-wrapper {
    position: fixed;
    right: 20px;
    bottom: 195px;
    z-index: 5000;
}

#notification-btn {
    position: relative;
    background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}

#notification-count {
    display: none;
    position: absolute;
    top: -5px;
    right: -5px;
    background: red;
    color: white;
    font-size: 12px;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 50%;
}

#notification-list {
    position: absolute;
    top: 55px;
    right: 0;
    background: #222;
    border: 1px solid #444;
    border-radius: 10px;
    width: 260px;
    max-height: 320px;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
}
#notification-list.hidden { display: none; }
#notification-list div {
    padding: 10px;
    border-bottom: 1px solid #333;
    cursor: pointer;
    color: #ddd;
}
#notification-list div:hover {
    background: #333;
}

#loader {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    z-index: 10;
    color: #fff;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
#loader .spinner {
    display: inline-block;
    animation: spin 1.1s linear infinite;
}

.touch-blocker {
    position: absolute;
    inset: 0;
    z-index: 1;
    display: none;
}

.controls-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 5;
    transition: opacity 0.3s ease;
    opacity: 0;
}

.player-card:hover .controls-bar {
    opacity: 1;
}

.center-play-pause-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid;
    place-items: center;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.55);
    border: 2px solid #fff;
    color: #fff;
    font-size: 28px;
    cursor: pointer;
    z-index: 6;
    transition: opacity 0.3s ease;
    opacity: 0;
}

.player-card:hover .center-play-pause-btn {
    opacity: 1;
}

.play-pause-btn {
    background: none;
    border: none;
    color: #fff;
    font-size: 24px;
    cursor: pointer;
}

.progress-bar {
    flex-grow: 1;
    height: 3px;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
}
.progress {
    height: 100%;
    width: 0%;
    background: #ff0000;
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 5px;
}
.volume-control input[type="range"] {
    width: 60px;
    -webkit-appearance: none;
    background: transparent;
}
.volume-control input[type="range"]::-webkit-slider-runnable-track {
    height: 3px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 1.5px;
}
.volume-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: #fff;
    margin-top: -4.5px;
}
.volume-icon {
    font-size: 20px;
}

.time {
    font-size: 12px;
    color: #fff;
}

/* Contenedor de comentarios */
.comments-overlay-container {
  position: fixed;
  bottom: 90px; /* 👈 ahora justo arriba de la barra de escribir */
  left: 10px;
  width: calc(80% - 20px);
  background: rgba(0, 0, 0, 0.2); /* más transparente */
  color: #eee;
  padding: 8px;
  border-radius: 5px;
  box-sizing: border-box;
  z-index: 998;
  overflow-y: auto;
  transition: opacity 0.3s ease, visibility 0.3s ease, max-height 0.3s ease;
  max-height: 4em;
  white-space: normal;
  word-wrap: break-word;
  overflow-wrap: break-word;
}


  /* expandido */
.comments-overlay-container.expanded {
  max-height: 70vh;
}
    /* Estilos para la lista de comentarios */
    .comments-overlay-container ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    /* Estilos para cada comentario individual */
    .comments-overlay-container li {
        font-size: 0.8rem;
        line-height: 1.2;
        margin-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 8px;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
    }

    .comments-overlay-container li:last-child {
      border-bottom: none;
    }
    
    /* Estilo para los comentarios que se pueden borrar */
    .comments-overlay-container li.deletable {
        cursor: pointer;
    }
    
    /* Contenedor del botón de borrado */
    .delete-btn-container {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #e74c3c;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 0; 
    }
    
    /* Botón de borrado en sí mismo */
    .delete-btn {
        color: white;
        font-weight: bold;
        padding: 10px;
        cursor: pointer;
        user-select: none;
    }
    
    /* El comentario se desliza */
    .comment-content {
      width: 100%;
      padding-left: 10px;
      padding-right: 10px;
      box-sizing: border-box;
      transition: transform 0.3s ease;
      position: relative;
      z-index: 1;
    }
    
    .comment-content.swiped {
      transform: translateX(100px);
    }
    
    .delete-btn-container.visible {
        transform: translateX(0);
    }
    
    /* Clase para ocultar los overlays */
.hidden-overlay {
  opacity: 0 !important;
  pointer-events: none !important;
  transition: opacity 0.3s;
}



    /* Estilos del nuevo contador de comentarios */
.comments-counter {
  position: fixed;
  bottom: 140px;
  right: 20px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  color: white;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  z-index: 999;
}

.comments-counter .icon {
  font-size: 24px;
  line-height: 1;
}

.comments-counter span#commentCountValue {
  display: none;
  position: absolute;
  bottom: -10px; /* Posiciona el número debajo del círculo */
  left: -10px; /* Posiciona el número a la izquierda */
  background: rgba(255, 255, 255, 0.1); /* Mismo fondo desenfocado que el círculo principal */
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color: white;
  font-size: 12px;
  font-weight: bold;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
    
    .comments-counter .count {
        font-size: 0.9rem;
    }

/* Barra de entrada de comentarios */
.comment-input-container {
  position: fixed;
  bottom: 39px;
  left: 0;
  width: 100%;
  background: transparent;
  padding: 8px 12px;
  box-sizing: border-box;
  z-index: 1000;
}



    
    .comment-input-container .send-comment-btn:hover {
        background: transparent;
    }

/* ✅ Nuevo diseño: óvalo translúcido */
.comment-input-wrapper {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.1); /* 👈 blanco transparente */
  border: 1.5px solid rgba(255, 255, 255, 0.4); /* 👈 borde translúcido */
  border-radius: 25px;   /* ovalado completo */
  width: 95%;            /* 👈 ancho controlado */
  margin: 0 auto;        /* 👈 centrado */
  padding: 4px 8px;      /* 👈 menos alto */
  backdrop-filter: blur(3px); /* 👈 efecto vidrio esmerilado */
}



.comment-input-wrapper input {
  flex-grow: 1;
  background: transparent;
  border: none;          /* 👈 quita borde extra */
  outline: none;
  padding: 6px 8px;      /* 👈 más compacto */
  font-size: 0.9rem;
  color: white;
}

.comment-input-wrapper input::placeholder {
  color: rgba(255,255,255,0.7);
}

.comment-input-wrapper button {
  background: transparent;
  border: none;
  color: white;
  font-size: 1.2rem;    /* 👈 tamaño justo */
  cursor: pointer;
  padding: 4px 6px;
}
/* Oculta el modal por defecto */
.hidden {
  display: none !important;
}

/* Fondo oscuro al abrir modal */
#search-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: flex-start; /* 👈 arriba */
  justify-content: center;
  padding-top: 40px;       /* 👈 separación desde arriba */
  z-index: 9999;
}


/* Contenedor del modal */
#search-modal .modal-content {
  background: #111;
  color: #fff;
  padding: 15px;
  border-radius: 8px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

/* Input */
#search-input {
  width: 100%;
  padding: 6px;
  margin-bottom: 10px;
  background: #222;
  border: 1px solid #444;
  color: white;
  border-radius: 5px;
}

/* Lista de resultados */
#search-results {
  max-height: 150px;
  overflow-y: auto;
  list-style: none;
  padding: 0;
  margin: 0;
}

#search-results li {
  padding: 8px;
  cursor: pointer;
  border-bottom: 1px solid #333;
}

#search-results li:hover {
  background: #333;
}

/* Botón cerrar */
#search-close {
  background: #444;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 5px;
  cursor: pointer;
}
/* Clase para resaltar título al saltar desde buscador */
/* Resaltado temporal para el contenedor de título */
#video-title-fixed.highlight-container {
  background: rgba(77, 163, 255, 0.35); /* azul suave translúcido */
  transition: background 0.5s ease;
}

.refresh-btn {
    position: fixed;
    bottom: 250px; /* 🔹 Un poco más arriba que la campana */
    right: 18px;
    width: 40px; /* Igual que .fab */
    height: 40px; /* Igual que .fab */
    border-radius: 50%;
    border: none;
   background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
    color: white; /* Ícono blanco */
    font-size: 24px; /* Igual que .fab */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4); /* Igual que .fab */
    z-index: 2000;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.refresh-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.5);
}

/* ✨ Resaltado temporal + zoom del título */
.highlight-title-zoom {
    background-color: rgba(0, 150, 255, 0.3);
    padding: 3px 6px;
    border-radius: 5px;
    animation: highlightZoom 0.4s ease-in-out;
    transition: background-color 1s ease;
}

/* 🎥 Animación de zoom */
@keyframes highlightZoom {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
    }
}

    #savedList {
    scroll-behavior: smooth;
}



body {
  margin: 0;
  padding: 0;
  background: #111;
  font-family: Arial, sans-serif;
  color: white;
  transition: transform 0.3s ease;
}

/* Estilos para el encabezado */
#socialHeader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.9); /* Ligeramente más opaco para elegancia */
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: 10001; /* Más alto que el resto de los overlays */
  padding: 8px 0; /* Reducido para un look más compacto */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); /* Sombra más sutil */
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 12px; /* Reducido para consistencia */
}

.header-content h1 {
  color: white;
  font-size: 1.4rem; /* Ligeramente más pequeño */
  margin: 0;
  font-weight: 600; /* Menos agresivo que bold */
  letter-spacing: 1px; /* Espaciado para elegancia */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

.header-buttons {
  display: flex;
  gap: 8px; /* Espaciado más ajustado */
}

.header-btn {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: none; /* Sin borde para un look más limpio */
  border-radius: 50%; /* Botones circulares */
  width: 36px; /* Tamaño fijo para íconos */
  height: 36px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.1rem; /* Tamaño del ícono */
  text-decoration: none;
  transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.header-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1); /* Efecto sutil de aumento */
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.3); /* Brillo suave */
}

.header-btn.selected {
  background: #ffffff; /* Fondo blanco */
  color: #111111; /* Ícono oscuro */
  box-shadow: 0 0 6px rgba(255, 255, 255, 0.5); /* Sombra para destacar */
  font-weight: bold; /* Mantenido para consistencia */
}

.header-btn.selected:hover {
  background: #e0e0e0; /* Ligeramente más oscuro al pasar el ratón */
  transform: scale(1); /* Evitar zoom al estar seleccionado */
}

/* Responsive para móviles */
@media (max-width: 768px) {
  .header-content {
    flex-direction: row; /* Mantener en fila para ahorrar espacio */
    gap: 8px;
  }

  .header-content h1 {
    font-size: 1.2rem; /* Más pequeño en móviles */
  }

  .header-buttons {
    gap: 6px; /* Menos espacio entre botones */
  }

  .header-btn {
    width: 32px; /* Botones más pequeños */
    height: 32px;
    font-size: 1rem; /* Íconos más pequeños */
  }
}
    </style>
</head>
<body>

<header id="socialHeader">
  <div class="header-content">
    <h1>DECOM</h1>
    <div class="header-buttons">
      <a href="https://artisticaipucbochicasur-code.github.io/pase-de-fotos-vertical/fotos.html" class="header-btn" title="Imágenes">
        <i class="fas fa-image"></i>
      </a>
      <a href="https://artisticaipucbochicasur-code.github.io/slider-de-videos/sliderVideos.html" class="header-btn" title="Videos">
        <i class="fas fa-video"></i>
      </a>
      <a href="#" class="header-btn" id="publishBtn" title="Publicar">
        <i class="fas fa-plus-circle"></i>
      </a>
    </div>
  </div>
</header>


<!-- Modal de inicio de sesión -->
<div id="loginModal" 
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.6); z-index:999; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:12px; width:300px; text-align:center;">
    <h3>🔐 Iniciar Sesión</h3>
    <input id="loginNombre" type="text" placeholder="Tu nombre" 
           style="width:100%;margin-top:10px;padding:8px;border-radius:6px;border:1px solid #ccc;">
    <input id="loginCorreo" type="email" placeholder="Tu correo" 
           style="width:100%;margin-top:10px;padding:8px;border-radius:6px;border:1px solid #ccc;">
    <button id="btnLogin" 
            style="margin-top:15px;width:100%;padding:10px;border:none;
                   background:#0077cc;color:white;border-radius:6px;">
      Entrar
    </button>
  </div>
</div>
    
    
<!-- BOTÓN GUARDAR/VER -->
<button id="saveBtn" style="
    position: fixed;
    bottom: 300px;
    right: 18px;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    z-index: 2000;
">
    <i class="far fa-bookmark" style="font-size: 24px;"></i>
</button>


<!-- 📌 Modal Guardados -->
<div id="savedModal" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(4px);
    z-index: 10000;
    align-items: center;
    justify-content: flex-start;
    flex-direction: column;
    padding: 15px;
">
    <div id="savedModalInner" style="
        background-color: #1c1c1c;
        color: white;
        width: 90%;
        max-width: 420px;
        max-height: 80%;
        border-radius: 12px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        margin-top: 16vh;
        transition: margin-top 0.25s ease;
    ">
        <!-- Encabezado -->
        <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: #1c1c1c;
            z-index: 20;
            padding-bottom: 8px;
        ">
            <h2 style="margin: 0; font-size: 18px; color: white;">🔖 Guardados</h2>
            <button id="closeSavedBtn" style="
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                line-height: 1;
            ">&times;</button>
        </div>

        <!-- Input de búsqueda -->
        <input
            id="savedSearchInput"
            type="text"
            placeholder="Buscar guardados..."
            style="
                position: sticky;
                top: 40px;
                z-index: 15;
                margin-top: 12px;
                padding: 10px;
                border: none;
                border-radius: 6px;
                background-color: #2c2c2c;
                color: white;
                font-size: 15px;
            "
        />

        <!-- Lista de guardados -->
        <ul id="savedList" style="
            list-style: none;
            padding: 0;
            margin: 15px 0 0;
            max-height: 250px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #555 #1c1c1c;
        "></ul>
    </div>
</div>




    
<!-- 🔍 Modal de búsqueda -->
<div id="search-modal" class="hidden">
  <div class="modal-content">
    <h3 style="margin:0 0 10px; font-size:18px;">Buscar video</h3>
    <input type="text" id="search-input" placeholder="Escribe el título...">
    <ul id="search-results"></ul>
    <div class="modal-actions" style="margin-top:10px; text-align:right;">
      <button id="search-close">Cerrar</button>
    </div>
  </div>
</div>

<!-- 🔄 Botón de actualizar -->
<button id="refreshBtn" class="refresh-btn" title="Actualizar página">
  <i class="fas fa-sync-alt"></i>
</button>

    
<div class="comments-overlay-container hidden-overlay" id="commentsOverlay">
  <ul id="commentsList"></ul>
</div>

<div class="comments-counter hidden-overlay" id="commentsCounter">
  <span class="icon">
    <i class="fa-regular fa-comment"></i>
  </span>
  <span class="count" id="commentCountValue">0</span>
</div>


<div class="comment-input-container hidden-overlay">
  <div class="comment-input-wrapper">
    <input type="text" id="commentInput" placeholder="Escribe un comentario...">
    <button class="send-comment-btn"><i class="fas fa-paper-plane"></i></button>
  </div>
</div>


    
<!-- Notificaciones -->
<div id="notification-wrapper">
  <button id="notification-btn">
    <i class="far fa-bell"></i>
    <span id="notification-count"></span>
  </button>
  <div id="notification-list" class="hidden"></div>
</div>

    
<div id="custom-alert-modal" class="modal hidden">
  <div class="modal-content">
    <h3>¡Atención!</h3>
    <p id="custom-alert-message"></p>
    <div class="modal-actions">
      <button id="custom-alert-ok" style="background:#007bff; color:white; padding:8px; border:none; border-radius:6px; cursor:pointer;">Aceptar</button>
    </div>
  </div>
</div>
<!-- Modal de eliminación -->
<div id="delete-modal" class="modal hidden">
  <div class="modal-content">
    <h3>¿Eliminar Video?</h3>
    <p id="delete-video-title">¿Seguro que deseas eliminar este video?</p>
    <div class="modal-actions">
      <button id="delete-confirm" style="background:#dc3545; color:white; padding:8px; border:none; border-radius:6px; cursor:pointer;">Eliminar</button>
      <button id="delete-cancel" style="background:#444; color:white; padding:8px; border:none; border-radius:6px; cursor:pointer;">Cancelar</button>
    </div>
  </div>
</div>

    
        <!-- BOTONES flotantes -->
   <div class="floating-buttons">
  <button id="btn-delete" class="fab danger"><i class="fas fa-trash"></i></button>
</div>

  

<div class="swiper">
  <div class="swiper-wrapper" id="slides">
    <!-- aquí solo van los slides -->
  </div>

  <!-- 👇 contenedor global del título, fuera de los slides -->
  <div id="video-title-fixed">
    <div class="video-title"></div>
    <div class="video-desc"></div>
  </div>
</div>



    <div id="loader"><span class="spinner">🔄</span></div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
  
    <script>
        const SCRIPT_URL =
            "https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec";


// ==========================
// 🔖 GUARDAR Y VER VIDEOS
// ==========================
const saveBtn = document.getElementById("saveBtn");
const viewSavedBtn = document.getElementById("viewSavedBtn");
const savedModal = document.getElementById("savedModal");
const savedList = document.getElementById("savedList");
const savedSearchInput = document.getElementById("savedSearchInput");
const closeSavedBtn = document.getElementById("closeSavedBtn");
const savedModalInner = document.getElementById("savedModalInner");

// ==========================
// ✅ FUNCIONES DE COOKIES (Compatibilidad WebViewer)
// ==========================
function setSavedVideos(data) {
    document.cookie = "savedVideos=" + encodeURIComponent(JSON.stringify(data)) + "; path=/; max-age=31536000";
}

function getSavedVideos() {
    const match = document.cookie.match(/(^| )savedVideos=([^;]+)/);
    return match ? JSON.parse(decodeURIComponent(match[2])) : [];
}

// 🔧 Normaliza texto: minúsculas, sin tildes, sin espacios extras
function normalizeText(text) {
    return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim();
}

// ==========================
// 💾 GUARDAR VIDEO ACTUAL
// ==========================
function saveCurrentVideo() {
    if (!swiper || lastVideos.length === 0) {
        showToast("⚠️ No hay videos para guardar");
        return;
    }

    const currentIndex = swiper.realIndex;
    const currentVideo = lastVideos[currentIndex];

    let saved = getSavedVideos();

    if (!saved.find(item => item.id === currentVideo.id)) {
        saved.push({
            id: currentVideo.id,
            // 👇 Ajuste aquí: usar title (si no existe, usa desc o texto genérico)
            titulo: currentVideo.title || currentVideo.desc || "Video sin título",
            desc: currentVideo.desc || ""
        });
        setSavedVideos(saved);
        showToast("✅ Video guardado");
    } else {
        showToast("ℹ️ Este video ya está guardado");
    }
}


// ==========================
// 📜 RENDERIZAR VIDEOS GUARDADOS
// ==========================
function renderSavedVideos(filter = "") {
    const saved = getSavedVideos();
    savedList.innerHTML = "";

    const filtered = saved.filter(item =>
        normalizeText(item.titulo).includes(normalizeText(filter))
    );

    // 🔹 Contenedor de botones (Guardar actual + Eliminar todo)
    const buttonsContainer = document.createElement("div");
    buttonsContainer.style.display = "flex";
    buttonsContainer.style.justifyContent = "space-between";
    buttonsContainer.style.gap = "10px";
    buttonsContainer.style.margin = "8px 0 10px";

    // Botón Guardar actual (siempre visible)
    const saveCurrentBtn = document.createElement("button");
    saveCurrentBtn.textContent = "💾 Guardar actual";
    saveCurrentBtn.style.flex = "1";
    saveCurrentBtn.style.background = "#007bff";
    saveCurrentBtn.style.color = "#fff";
    saveCurrentBtn.style.border = "none";
    saveCurrentBtn.style.borderRadius = "6px";
    saveCurrentBtn.style.padding = "6px 12px";
    saveCurrentBtn.style.cursor = "pointer";
    saveCurrentBtn.style.fontSize = "13px";
    saveCurrentBtn.style.transition = "background 0.2s ease";

    saveCurrentBtn.addEventListener("mouseenter", () => {
        saveCurrentBtn.style.background = "#3399ff";
    });
    saveCurrentBtn.addEventListener("mouseleave", () => {
        saveCurrentBtn.style.background = "#007bff";
    });
    saveCurrentBtn.addEventListener("click", () => {
        saveCurrentVideo();
        renderSavedVideos(filter); // refresca la lista
    });

    buttonsContainer.appendChild(saveCurrentBtn);

    // Botón Eliminar todo (solo si hay más de uno)
    if (filtered.length > 1) {
        const clearAllBtn = document.createElement("button");
        clearAllBtn.textContent = "Eliminar todo";
        clearAllBtn.style.flex = "1";
        clearAllBtn.style.background = "#2c2c2c";
        clearAllBtn.style.color = "#ccc";
        clearAllBtn.style.border = "1px solid #444";
        clearAllBtn.style.borderRadius = "6px";
        clearAllBtn.style.padding = "6px 12px";
        clearAllBtn.style.cursor = "pointer";
        clearAllBtn.style.fontSize = "13px";
        clearAllBtn.style.transition = "background 0.2s ease";

        clearAllBtn.addEventListener("mouseenter", () => {
            clearAllBtn.style.background = "#3a3a3a";
        });
        clearAllBtn.addEventListener("mouseleave", () => {
            clearAllBtn.style.background = "#2c2c2c";
        });
        clearAllBtn.addEventListener("click", () => {
            setSavedVideos([]);
            renderSavedVideos();
            showToast("✅ Todos los videos fueron eliminados");
        });

        buttonsContainer.appendChild(clearAllBtn);
    }

    savedList.appendChild(buttonsContainer);

    if (filtered.length === 0) {
        // ⬇️ Crear mensaje vacío sin borrar el botón
        const emptyMsg = document.createElement("li");
        emptyMsg.textContent = "No hay videos guardados";
        emptyMsg.style.color = "#777";
        emptyMsg.style.padding = "10px";
        savedList.appendChild(emptyMsg);

        savedModalInner.style.transform = "translateY(-60px)";
    } else {
        savedModalInner.style.transform = "translateY(0)";
    }

    // 🔹 Renderizar cada item guardado
    filtered.forEach(item => {
        const li = document.createElement("li");
        li.style.display = "flex";
        li.style.justifyContent = "space-between";
        li.style.alignItems = "center";
        li.style.padding = "10px";
        li.style.borderBottom = "1px solid #333";
        li.style.color = "#fff";
        li.style.transition = "opacity 0.3s ease, transform 0.3s ease";

        const titleSpan = document.createElement("span");
        titleSpan.textContent = item.titulo;
        titleSpan.style.cursor = "pointer";
        titleSpan.style.flex = "1";

        // Click → ir al video
        titleSpan.addEventListener("click", () => {
            const videoIndex = lastVideos.findIndex(v => v.id === item.id);

            if (videoIndex !== -1) {
                swiper.slideToLoop(videoIndex, 0, false);
                savedModal.style.display = "none";

                setTimeout(() => {
                    const tituloActual = document.querySelector("#video-title-fixed .video-title");
                    if (tituloActual) {
                        tituloActual.classList.add("highlight-title-zoom");
                        tituloActual.scrollIntoView({ behavior: "smooth", block: "center" });
                        setTimeout(() => {
                            tituloActual.classList.remove("highlight-title-zoom");
                        }, 2000);
                    }
                }, 400);
            } else {
                showToast("⚠️ Este video ya no está disponible");
            }
        });

        // Botón eliminar ❌
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "✕";
        deleteBtn.style.background = "transparent";
        deleteBtn.style.border = "none";
        deleteBtn.style.color = "#aaa";
        deleteBtn.style.fontSize = "14px";
        deleteBtn.style.cursor = "pointer";
        deleteBtn.style.marginLeft = "10px";
        deleteBtn.style.transition = "color 0.2s ease";

        deleteBtn.addEventListener("mouseenter", () => {
            deleteBtn.style.color = "#fff";
        });
        deleteBtn.addEventListener("mouseleave", () => {
            deleteBtn.style.color = "#aaa";
        });

        deleteBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            li.style.opacity = "0";
            li.style.transform = "translateX(30px)";

            setTimeout(() => {
                const updated = saved.filter(s => s.id !== item.id);
                setSavedVideos(updated);
                renderSavedVideos(filter);
                showToast("🗑️ Eliminado de guardados");
            }, 300);
        });

        li.appendChild(titleSpan);
        li.appendChild(deleteBtn);
        savedList.appendChild(li);
    });
}







// ==========================
// 📌 EVENTOS DE LOS BOTONES
// ==========================
saveBtn.addEventListener("click", () => {
    savedSearchInput.value = "";
    renderSavedVideos();
    setTimeout(() => {
        savedModal.style.display = "flex";
        savedList.scrollTop = 0;
    }, 50);
});

savedSearchInput.addEventListener("input", (e) => {
    renderSavedVideos(e.target.value);
});

closeSavedBtn.addEventListener("click", () => {
    savedModal.style.display = "none";
});

savedModal.addEventListener("click", (e) => {
    if (e.target === savedModal) {
        savedModal.style.display = "none";
    }
});

// ==========================
// 🍞 TOASTS PERSONALIZADOS
// ==========================
function showToast(msg) {
    const toast = document.createElement("div");
    toast.textContent = msg;
    toast.style.position = "fixed";
    toast.style.bottom = "80px";
    toast.style.left = "50%";
    toast.style.transform = "translateX(-50%)";
    toast.style.background = "rgba(0,0,0,0.85)";
    toast.style.color = "white";
    toast.style.padding = "10px 16px";
    toast.style.borderRadius = "6px";
    toast.style.fontSize = "14px";
    toast.style.zIndex = "100000";
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2500);
}





        

// === Comentarios móviles ===
const commentsOverlay = document.getElementById('commentsOverlay');
const commentsCounter = document.getElementById('commentsCounter');
const commentCountValue = document.getElementById('commentCountValue');
const commentsList = document.getElementById('commentsList');
const commentInputContainer = document.querySelector('.comment-input-container');
const commentInput = document.getElementById('commentInput');
const sendCommentBtn = document.querySelector('.send-comment-btn');
const notificationWrapper = document.getElementById('notification-wrapper');
const notificationList = document.getElementById('notification-list');

let comentariosPorVideo = {}; // videoId: [ {autor, correo, fecha, comentario} ]
let lastTapTime = 0;
let activeComment = null;
let startX = 0;
let isSwiping = false;

const refreshBtn = document.getElementById("refreshBtn");

if (refreshBtn) {
  refreshBtn.addEventListener("click", () => {
    location.reload(); // 🔄 Recarga la página completamente
  });
}


// === 💬 Aviso elegante, centrado y adaptable a móviles ===
function mostrarAviso(mensaje, tipo = "info") {
  let alertBox = document.getElementById("alertBox");

  if (!alertBox) {
    alertBox = document.createElement("div");
    alertBox.id = "alertBox";
    document.body.appendChild(alertBox);

    Object.assign(alertBox.style, {
      display: "none",
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%) scale(0.9)",
      background: "rgba(30, 30, 30, 0.9)",
      color: "#fff",
      padding: "14px 24px",
      borderRadius: "14px",
      boxShadow: "0 8px 25px rgba(0,0,0,0.4)",
      fontWeight: "500",
      fontSize: "15px",
      fontFamily: "Poppins, sans-serif",
      zIndex: "100000",
      opacity: "0",
      transition: "all 0.4s ease",
      textAlign: "center",
      whiteSpace: "nowrap", // ✅ evita salto de línea
      overflow: "hidden",
      textOverflow: "ellipsis",
      maxWidth: "90vw", // ✅ limita al ancho de pantalla
      letterSpacing: "0.3px",
      backdropFilter: "blur(10px)",
      border: "1px solid rgba(255,255,255,0.1)",
    });
  }

  // 🎨 Colores neutros según tipo
  let bgColor = "rgba(30, 30, 30, 0.9)";
  if (tipo === "error") bgColor = "rgba(50, 50, 50, 0.95)";
  if (tipo === "success") bgColor = "rgba(45, 45, 45, 0.95)";
  if (tipo === "warning") bgColor = "rgba(70, 70, 70, 0.95)";
  if (tipo === "info") bgColor = "rgba(35, 35, 35, 0.9)";

  alertBox.style.background = bgColor;
  alertBox.textContent = mensaje;
  alertBox.style.display = "block";

  // ✨ Animación elegante
  setTimeout(() => {
    alertBox.style.opacity = "1";
    alertBox.style.transform = "translate(-50%, -50%) scale(1)";
  }, 50);

  // ⏳ Desaparición automática
  setTimeout(() => {
    alertBox.style.opacity = "0";
    alertBox.style.transform = "translate(-50%, -50%) scale(0.95)";
    setTimeout(() => {
      alertBox.style.display = "none";
    }, 400);
  }, 3000);
}

        
        
document.addEventListener("DOMContentLoaded", () => {
  // 🛑 BLOQUEO Y MOSTRAR MODAL SI NO HAY SESIÓN ACTIVA
  const usuarioGuardado = JSON.parse(localStorage.getItem("usuario"));
  const modal = document.getElementById("loginModal");
  const btnLogin = document.getElementById("btnLogin");

  if (!usuarioGuardado) {
    const overlay = document.createElement("div");
    Object.assign(overlay.style, {
      position: "fixed",
      top: "0",
      left: "0",
      width: "100%",
      height: "100%",
      background: "linear-gradient(180deg, #000, #222)",
      color: "white",
      display: "flex",
      flexDirection: "column",
      alignItems: "center",
      justifyContent: "center",
      zIndex: "99998",
      fontFamily: "Poppins, sans-serif",
      textAlign: "center",
      opacity: "0",
      transition: "opacity 0.4s ease",
    });
    overlay.innerHTML = `
      <h2 style="margin-bottom:12px; font-size:22px;">🔒 Acceso restringido</h2>
      <p style="color:#ccc; max-width:80%; line-height:1.5;">
        Debes iniciar sesión para acceder al contenido.
      </p>
    `;
    document.body.appendChild(overlay);

    if (modal) {
      modal.style.display = "flex";
      modal.style.zIndex = "99999";
    }
    setTimeout(() => (overlay.style.opacity = "1"), 50);

    if (btnLogin) {
      btnLogin.addEventListener("click", () => {
        const nombre = document.getElementById("loginNombre").value.trim();
        const correo = document.getElementById("loginCorreo").value.trim();

        if (!nombre || !correo) {
          mostrarAviso("⚠️ Todos los campos son obligatorios", "error");
          return;
        }

        const usuario = { nombre, correo };
        currentAuthorName = nombre;
        currentAuthorEmail = correo;

        localStorage.setItem("usuario", JSON.stringify(usuario));
        localStorage.setItem("autor", nombre);
        localStorage.setItem("correo", correo);

        modal.style.display = "none";
        mostrarAviso("✅ Sesión iniciada correctamente", "success");

        overlay.style.opacity = "0";
        setTimeout(() => overlay.remove(), 400);

        location.reload();
      });
    }
    return; // No ejecutar el resto hasta iniciar sesión
  }

  // ======================================================================================
  // 👇 Tu código original (sin tocar)
  // ======================================================================================

  const currentUrl = window.location.href;
  const imagesBtn = document.querySelector('a[href="https://artisticaipucbochicasur-code.github.io/pase-de-fotos-vertical/fotos.html"]');
  const videosBtn = document.querySelector('a[href="https://artisticaipucbochicasur-code.github.io/slider-de-videos/sliderVideos.html"]');
  if (currentUrl.includes("/pase-de-fotos-vertical/fotos.html")) {
    imagesBtn?.classList.add("selected");
  } else if (currentUrl.includes("/slider-de-videos/sliderVideos.html")) {
    videosBtn?.classList.add("selected");
  }

  // 🔔 Inicializar icono de notificaciones
  const lblContador = document.getElementById('lblContador');
  if (lblContador) {
    lblContador.innerHTML = `
      <i class="far fa-bell"></i>
      <span id="notificationCount" style="display:none"></span>
    `;
    lblContador.style.display = "flex";
  }

  if (window.AppInventor) {
    setInterval(() => {
      const comando = window.AppInventor.getWebViewString?.();
      if (comando) {
        try {
          const data = JSON.parse(comando);
          if (data.action === "updateUserData") {
            currentAuthorEmail = data.email;
            currentAuthorName = data.name;

            localStorage.setItem("autor", currentAuthorName || "");
            localStorage.setItem("correo", currentAuthorEmail || "");

            console.log(`Datos de usuario actualizados. Nombre: ${currentAuthorName}, Correo: ${currentAuthorEmail}`);
          }
        } catch (e) {
          // Otros comandos
        }
      }
    }, 500);
  }

  // === 🔐 INICIO DE SESIÓN LOCAL ===
  const userBtn = document.getElementById("userBtn");
  const userMenu = document.getElementById("userMenu");
  const userName = document.getElementById("userName");
  const userEmail = document.getElementById("userEmail");
  const logoutBtn = document.getElementById("logoutBtn");

  if (userBtn && userMenu && userName && userEmail && logoutBtn) {
    const usuario = JSON.parse(localStorage.getItem("usuario"));
    if (usuario) mostrarUsuario(usuario);

    function mostrarUsuario(u) {
      const iniciales = u.nombre.split(" ").map(n => n[0]).join("").substring(0, 2).toUpperCase();
      userBtn.textContent = iniciales;
      userName.textContent = u.nombre;
      userEmail.textContent = u.correo;

      userName.style.color = "#333";
      userEmail.style.color = "#555";

      currentAuthorName = u.nombre;
      currentAuthorEmail = u.correo;
    }

    // 🔹 Mostrar comentarios al iniciar sesión (como antes)
    const commentsOverlay = document.getElementById("commentsOverlay");
    const commentsCounter = document.getElementById("commentsCounter");
    const commentInputContainer = document.querySelector(".comment-input-container");

    commentsOverlay?.classList.remove("hidden-overlay");
    commentsCounter?.classList.remove("hidden-overlay");
    commentInputContainer?.classList.remove("hidden-overlay");

    userBtn.addEventListener("click", () => {
      userMenu.style.display = userMenu.style.display === "block" ? "none" : "block";
    });

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("usuario");
      localStorage.removeItem("autor");
      localStorage.removeItem("correo");
      currentAuthorName = "";
      currentAuthorEmail = "";
      userMenu.style.display = "none";

      mostrarAviso("🚪 Sesión cerrada", "info");

      setTimeout(() => {
        location.reload();
      }, 1200);
    });
  }
});









// Mostrar/ocultar overlays al tocar el slider
document.querySelector('.swiper').addEventListener('click', (e) => {
  // 👉 Evitar que se cierre si se hace click en el título o descripción
  if (e.target.closest('#video-title-fixed')) {
    return; // no hacer nada
  }

  const currentTime = new Date().getTime();
  if (currentTime - lastTapTime > 300) {
    commentsOverlay.classList.toggle('hidden-overlay');
    commentsCounter.classList.toggle('hidden-overlay');
    commentInputContainer.classList.toggle('hidden-overlay');

    // 🔔 Ocultar botón y lista de notificaciones
    notificationWrapper.classList.toggle('hidden-overlay');
    notificationList.classList.add('hidden'); // Cierra la lista si estaba abierta

    // 👇 También alternar el título
    document.getElementById("video-title-fixed").classList.toggle("hidden-overlay");

    // 🆕 También ocultar/mostrar el botón de actualizar
    const refreshBtn = document.getElementById("refreshBtn");
    if (refreshBtn) {
      refreshBtn.classList.toggle("hidden-overlay");
    }

    // 🆕 Ocultar/mostrar guardar y ver guardados
    const saveBtn = document.getElementById("saveBtn");
    const viewSavedBtn = document.getElementById("viewSavedBtn");
    if (saveBtn) saveBtn.classList.toggle("hidden-overlay");
    if (viewSavedBtn) viewSavedBtn.classList.toggle("hidden-overlay");

    // 🆕 Ocultar/mostrar contenedor de botones flotantes
    const floatingButtons = document.querySelector(".floating-buttons");
    if (floatingButtons) {
      floatingButtons.classList.toggle("hidden-overlay");
    }

    // 🆕 Alternar el encabezado DECOM y botones
    const socialHeader = document.getElementById("socialHeader");
    if (socialHeader) {
      socialHeader.classList.toggle("hidden-overlay");
    }
  }
  lastTapTime = currentTime;
});







// === Expandir / Colapsar comentarios ===
commentsOverlay.addEventListener('click', (e) => {
  if (!isSwiping) {
    commentsOverlay.classList.toggle('expanded');
  }
  isSwiping = false;
});


// === Obtener el ID del video activo ===
function getActiveVideoId() {
  if (!swiper) return null;
  const activeSlide = swiper.slides[swiper.activeIndex];
  if (!activeSlide) return null;
  return activeSlide.dataset.videoid || null;
}

// 🚀 Apenas carga la página, enviamos "success" a App Inventor
window.addEventListener("load", () => {
  try {
    if (typeof AppInventor !== "undefined" && AppInventor.setWebViewString) {
      AppInventor.setWebViewString("success");
      console.log("✅ Se envió 'success' a App Inventor");
    }
  } catch (err) {
    console.warn("No se pudo enviar 'success' a App Inventor:", err);
  }
});


        
// 🗂️ Caché de comentarios
const comentariosCache = {}; // { videoId: [comentarios] }

// === Cargar comentarios desde Google Sheets con caché ===
// === Cargar comentarios desde Google Sheets con caché ===
// 🚀 Optimización: evitar fetch innecesarios y permitir forzar recarga
async function cargarComentarios(videoId, render = true, options = {}) {
  if (!videoId) return;

  const force = options.force || false;

  // ✅ Si ya tenemos en caché y no forzamos → render instantáneo
  if (!force && comentariosCache[videoId]) {
    comentariosPorVideo[videoId] = comentariosCache[videoId];
    if (render) renderComentarios(videoId);
    return;
  }

  // ✅ Si ya tenemos en memoria y no forzamos → usar eso
  if (!force && comentariosPorVideo[videoId]) {
    comentariosCache[videoId] = comentariosPorVideo[videoId];
    if (render) renderComentarios(videoId);
    return;
  }

  // ⚡ Si no hay datos o se forzó → fetch directo al servidor (con cache-buster)
  try {
    const res = await fetch(
      `${SCRIPT_URL}?accion=listarComentarios&videoId=${encodeURIComponent(videoId)}&_=${Date.now()}`
    );
    const data = await res.json();

    comentariosPorVideo[videoId] = Array.isArray(data.data)
      ? data.data.map(c => ({
          autor: c[2] || "Anónimo",
          comentario: c[1] || "",
          // 🔹 Formatear fecha siempre a local string
          fecha: c[4] ? new Date(c[4]).toLocaleString() : "",
          correo: c[3] || ""
        }))
      : [];

    comentariosCache[videoId] = comentariosPorVideo[videoId];

    if (render) renderComentarios(videoId);
  } catch (e) {
    console.error("Error cargando comentarios:", e);
    comentariosPorVideo[videoId] = [];
    comentariosCache[videoId] = [];
    if (render) renderComentarios(videoId);
  }
}



function renderComentarios(videoId) {
  if (!videoId) return;

  const lista = comentariosPorVideo[videoId] || [];
  const commentsList = document.getElementById('commentsList');
  const commentCountValue = document.getElementById('commentCountValue');

  if (!commentsList || !commentCountValue) {
    console.error("❌ Error: Contenedor de comentarios o contador no encontrado en el DOM");
    return;
  }

  // --- Guardar el texto y correo del comentario swiped actual ---
  let swipedData = null;
  const swipedComment = document.querySelector('li.swiped');
  if (swipedComment) {
    swipedData = {
      texto: swipedComment.dataset.texto,
      correo: swipedComment.dataset.correo
    };
  }

  commentsList.innerHTML = '';

  // 🔥 FIX2: Reforzado para siempre mostrar mensaje si length === 0 exacto
  if (lista.length === 0) {
    commentsList.innerHTML = '<li>Sé el primero en comentar...</li>';
    commentCountValue.textContent = "0";
  } else {
    // 🔥 FIX13: Invertir el orden de los comentarios para que el más reciente esté arriba
    const comentariosInvertidos = [...lista].reverse();
    comentariosInvertidos.forEach(c => {
      const li = document.createElement('li');
      li.classList.add('deletable');

      const commentContent = document.createElement('div');
      commentContent.className = 'comment-content';
      commentContent.textContent = `${c.autor} (${c.fecha}) - ${c.comentario}`;
      li.appendChild(commentContent);

      li.dataset.correo = c.correo;
      li.dataset.texto = c.comentario;

      if (normalizeText(c.correo) === normalizeText(currentAuthorEmail)) {
        const deleteBtnContainer = document.createElement('div');
        deleteBtnContainer.className = 'delete-btn-container';
        const deleteBtn = document.createElement('div');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Borrar';
        deleteBtnContainer.appendChild(deleteBtn);
        li.appendChild(deleteBtnContainer);

        deleteBtn.addEventListener('click', async (ev) => {
          ev.stopPropagation();
          await eliminarComentario(videoId, c.comentario, c.correo);
          renderComentarios(videoId);
        });
      }

      // --- Si este es el comentario swiped, restaura el swipe ---
      if (
        swipedData &&
        normalizeText(c.correo) === normalizeText(swipedData.correo) &&
        c.comentario === swipedData.texto
      ) {
        li.classList.add('swiped');
        commentContent.classList.add('swiped');
        commentContent.style.transform = `translateX(100px)`;
        const deleteBtnContainer = li.querySelector('.delete-btn-container');
        if (deleteBtnContainer) {
          deleteBtnContainer.classList.add('visible');
          deleteBtnContainer.style.transform = `translateX(0)`;
        }
      }

      commentsList.appendChild(li);
    });

    commentCountValue.textContent = lista.length;
  }

  console.log(`✅ Renderizados ${lista.length} comentarios para video ${videoId} en orden inverso`);
    if (window.restoreSwipeAfterRender) window.restoreSwipeAfterRender();
}

// === Enviar un nuevo comentario ===
async function enviarComentario() {
  const texto = commentInput.value.trim();
  const videoId = getActiveVideoId();
  if (!texto || !videoId) return;

  sendCommentBtn.disabled = true;

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({
        accion: "agregarComentarioVideo",
        videoId,
        comentario: texto,
        autor: currentAuthorName ,
        correo: currentAuthorEmail,
      })
    });
    const data = await res.json();

    if (data.status === "success") {
      commentInput.value = "";
      // 🔄 Forzar recarga real desde servidor
      await cargarComentarios(videoId, true, { force: true });

      // ✅ Actualizar timestamp local y notificar a otros dispositivos
      ultimaActualizacionComentarios = String(Date.now());
      // 🚀 Notificar a otros dispositivos
      notificarCambioComentarios();
    } else {
      console.error("❌ No se pudo guardar:", data.message);
    }
  } catch (e) {
    console.error("Error al enviar comentario:", e);
  } finally {
    sendCommentBtn.disabled = false;
  }
}


// === Listeners del input ===
sendCommentBtn.addEventListener('click', enviarComentario);

commentInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') enviarComentario();
});

commentInput.addEventListener('focus', () => {
  document.body.style.transform = `translateY(-50%)`;
});

// 🔹 Cuando el input baja (pierde foco), se envía automáticamente si tiene texto
commentInput.addEventListener('blur', () => {
  document.body.style.transform = `translateY(0)`;

  // Verificar si hay texto para enviar
  const comentarioTexto = commentInput.value.trim();
  if (comentarioTexto !== "") {
    enviarComentario();
  }
});



// === Precargar todos los comentarios al inicio ===
async function precargarComentariosTodos(videos) {
  for (const v of videos) {
    // ⚡ Carga los comentarios pero NO renderiza si no es el video activo
    await cargarComentarios(v.id, false);
  }
  console.log("✅ Todos los comentarios precargados en caché");
}

// === Eliminar comentario ===
async function eliminarComentario(videoId, comentario, correo) {
  if (!videoId || !comentario || !correo) return;

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({
        accion: "eliminarComentario",
        videoId,
        comentario,
        correo
      })
    });
    const data = await res.json();

    if (data.status === "success") {
      // 🔄 Forzar recarga real desde servidor
      await cargarComentarios(videoId, true, { force: true });

      // ✅ Actualizar timestamp local y notificar a otros dispositivos
      ultimaActualizacionComentarios = String(Date.now());
      // 🚀 Notificar a otros dispositivos
      notificarCambioComentarios();
    } else {
      console.error("❌ No se eliminó:", data.message);
    }
  } catch (e) {
    console.error("Error al eliminar comentario:", e);
  }
}


// === 🔄 Sincronización de comentarios en tiempo casi real ===
let ultimaActualizacionComentarios = "";

// Inicializa el timestamp al cargar (evita primer “false positive”)
async function initSyncComentarios() {
  try {
    const res = await fetch(`${SCRIPT_URL}?accion=ultimaActualizacionComentarios&_=${Date.now()}`);
    const data = await res.json();
    ultimaActualizacionComentarios = data.timestamp || "";
  } catch (e) {
    console.warn("No se pudo inicializar sync de comentarios:", e);
  }
}
document.addEventListener('DOMContentLoaded', initSyncComentarios);

// Verifica en el servidor si hubo cambios (con cache-buster)
async function verificarComentariosVideos() {
  try {
    const res = await fetch(`${SCRIPT_URL}?accion=ultimaActualizacionComentarios&_=${Date.now()}`);
    const data = await res.json();

    if (data.timestamp && data.timestamp !== ultimaActualizacionComentarios) {
      ultimaActualizacionComentarios = data.timestamp;

      // 🔥 FIX2: Usar lastVideos para obtener TODOS los videoIds conocidos y recargarlos (sin render, background)
      const videoIds = lastVideos.map(v => v.id);
      for (const videoId of videoIds) {
        await cargarComentarios(videoId, false, { force: true }); // No render, solo caché fresco
      }

      // Luego, render solo para el activo (con datos frescos)
      const videoIdActivo = getActiveVideoId();
      if (videoIdActivo) {
        renderComentarios(videoIdActivo);
      }
    }
  } catch (err) {
    console.warn("No se pudo verificar comentarios:", err);
  }
}




// Cada 5 segundos verificamos si hubo cambios
setInterval(verificarComentariosVideos, 5000);

// --- HOOK para disparar verificación inmediata tras alta/baja ---
function notificarCambioComentarios() {
  // 🔥 FIX2: Pequeño delay para asegurar que el servidor actualice el timestamp antes del chequeo
  setTimeout(verificarComentariosVideos, 0);
}






// === Cargar comentarios en tiempo real ===
function iniciarComentariosTiempoReal() {
  if (comentariosInterval) clearInterval(comentariosInterval);

  const videoId = getActiveVideoId();
  if (!videoId) return;

  cargarComentarios(videoId);

  comentariosInterval = setInterval(() => {
    const idActual = getActiveVideoId();
    if (idActual) cargarComentarios(idActual);
  }, 3000);
}

// === Utilidad para normalizar texto/correos ===
function normalizeText(text) {
  return (text || "").normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().toLowerCase();
}



        
// === NOTIFICACIONES ===
let notifications = [];
let lastVideos = [];

function renderNotifications() {
  const list = document.getElementById("notification-list");
  const count = document.getElementById("notification-count");
  const notificationBtn = document.getElementById("notification-btn");
  const bellIcon = notificationBtn.querySelector("i"); // Seleccionar el elemento <i> de la campana

  if (!list || !count || !notificationBtn || !bellIcon) {
    console.error("❌ Error: Elementos de notificaciones no encontrados en el DOM");
    return;
  }

  list.innerHTML = "";

  if (notifications.length === 0) {
    list.innerHTML = "<div>Sin notificaciones</div>";
    count.textContent = "";
    count.style.display = "none";
    bellIcon.className = "far fa-bell"; // Campana vacía cuando no hay notificaciones

    try {
      if (typeof AppInventor !== "undefined" && AppInventor.setWebViewString) {
        AppInventor.setWebViewString("0");
      }
    } catch (e) {
      console.warn("No se pudo enviar a App Inventor:", e);
    }
    return;
  }

  count.textContent = notifications.length;
  count.style.display = "block";
  bellIcon.className = "fas fa-bell"; // Campana rellena cuando hay notificaciones

  notifications.forEach((notif, i) => {
    if (!notif || !notif.link || !notif.title || !notif.id) {
      console.warn("⚠️ Notificación inválida detectada:", notif);
      return;
    }

    const item = document.createElement("div");
    item.textContent = notif.title;
    item.style.cursor = "pointer";
    item.style.padding = "10px";
    item.style.userSelect = "none";

    item.onclick = () => {
      console.log("🔹 Click en notificación detectado:", notif.title, "ID:", notif.id);

      // Marcar como leída y cerrar panel INMEDIATAMENTE
      notifications.splice(i, 1);
      renderNotifications();
      document.getElementById("notification-list").classList.add("hidden");
      console.log("✅ Notificación marcada como leída y panel cerrado");

      const wrapper = document.getElementById("slides");
      if (!wrapper || !swiper) {
        console.error("❌ Error: Contenedor de slides o Swiper no encontrado");
        return;
      }

      // Guardar y precargar comentarios del video actual
      const currentVideoId = getActiveVideoId();
      if (currentVideoId && !comentariosPorVideo[currentVideoId]) {
        cargarComentarios(currentVideoId, false, { force: true }).catch(e => console.warn("Error precargando comentarios actuales:", e));
        console.log(`✅ Precargando comentarios para video actual ${currentVideoId}`);
      }

      // Buscar si ya existe el slide usando videoId
      let slide = Array.from(wrapper.children).find(s => s.dataset.videoid === notif.id);
      let isNewSlide = !slide;
      let targetIndex = -1;

      if (isNewSlide) {
        // Desactivar loop temporalmente si hay pocos slides para evitar bugs
        const originalLoop = swiper.params.loop;
        if (swiper.slides.length < 3) {
          swiper.params.loop = false;
          swiper.update();
          console.log("🔹 Loop desactivado temporalmente (pocos slides)");
        }

        const nuevoSlide = createSlide(notif.title, notif.link, notif.desc, notif.id);
        swiper.appendSlide(nuevoSlide);
        swiper.update(); // Actualizar estructura
        swiper.loopFix(); // Reparar clones y loop mode
        console.log("✅ Nuevo slide añadido, loopFix aplicado, ID:", notif.id);

        // Reactivar loop si se desactivó
        if (swiper.slides.length < 3 && originalLoop) {
          swiper.params.loop = true;
          swiper.update();
          swiper.loopFix();
          console.log("🔹 Loop reactivado");
        }

        targetIndex = swiper.slides.length - 1;
        lastVideos.push({ title: notif.title, link: notif.link, desc: notif.desc, id: notif.id });
        cargarComentarios(notif.id, false, { force: true }).catch(e => console.warn("Error precargando comentarios del nuevo video:", e));
      } else {
        // Para slide existente, usar método de Swiper para índice real en loop
        targetIndex = swiper.getSlideIndexByData('videoid', notif.id);
        if (targetIndex === undefined) {
          // Fallback manual
          swiper.slides.forEach((s, idx) => {
            if (s.dataset.videoid === notif.id) targetIndex = idx;
          });
        }
        console.log(`✅ Slide existente encontrado en índice: ${targetIndex}, ID: ${notif.id}`);
      }

      if (targetIndex !== -1) {
        console.log(`🔹 Iniciando navegación a índice ${targetIndex} con slideToLoop`);
        setTimeout(() => {
          cleanupIframesExceptActiveAndAdjacent(); // Limpiar después de adición
          swiper.slideToLoop(targetIndex, 500); // Transición más lenta para WebView
          updateFixedTitle(swiper);

          // Montaje del video con delay adicional
          setTimeout(() => {
            const activeCard = swiper.slides[swiper.activeIndex]?.querySelector('.player-card');
            if (activeCard) {
              const src = activeCard.dataset.embed;
              if (!activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                mountIframe(activeCard, true);
                console.log("✅ Video montado y reproducido");
              } else {
                const player = players[src];
                if (player) {
                  if (typeof player.playVideo === 'function') {
                    player.playVideo();
                  } else if (typeof player.play === 'function') {
                    player.play().catch(e => console.warn("Error al reproducir:", e));
                  }
                  console.log("🔹 Video existente reproducido");
                }
              }
            }

            const videoId = getActiveVideoId();
            if (videoId) {
              if (!comentariosPorVideo[videoId] || comentariosPorVideo[videoId].length === 0) {
                cargarComentarios(videoId, true, { force: true }).catch(e => console.warn("Error cargando comentarios:", e));
              } else {
                renderComentarios(videoId);
              }
              console.log(`✅ Comentarios manejados para video ${videoId}`);
            }
          }, 300);
        }, 500); // Retraso inicial mayor para WebView

        // Listener para fin de transición
        swiper.once('slideChangeTransitionEnd', () => {
          console.log("✅ Transición completada, índice activo:", swiper.activeIndex);
          swiper.loopFix(); // Reparar loop nuevamente si es necesario
          cleanupIframesExceptActiveAndAdjacent();
          const activeCard = document.querySelector('.swiper-slide-active .player-card');
          if (activeCard && !activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
            mountIframe(activeCard, true);
            console.log("✅ Video montado tras transición");
          }
          const videoIdFinal = getActiveVideoId();
          if (videoIdFinal) {
            if (!comentariosPorVideo[videoIdFinal] || comentariosPorVideo[videoIdFinal].length === 0) {
              cargarComentarios(videoIdFinal, true, { force: true }).catch(e => console.warn("Error en comentarios finales:", e));
            } else {
              renderComentarios(videoIdFinal);
            }
          }
          if (currentVideoId && comentariosPorVideo[currentVideoId]) {
            console.log(`✅ Restaurando comentarios para video original ${currentVideoId}`);
            renderComentarios(currentVideoId);
          }
        });
      } else {
        console.error("❌ Error: Índice no válido para video, ID:", notif.id);
      }
    };

    list.appendChild(item);
  });

  try {
    if (typeof AppInventor !== "undefined" && AppInventor.setWebViewString) {
      AppInventor.setWebViewString(String(notifications.length));
    }
  } catch (e) {
    console.warn("No se pudo enviar a App Inventor:", e);
  }
}
// --- BOTÓN NOTIFICACIONES UNIVERSAL ---
const notifBtn = document.getElementById("notification-btn");
const notifList = document.getElementById("notification-list");

// Mostrar/ocultar la lista al tocar el botón (desktop y móvil)
notifBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  notifList.classList.toggle("hidden");
});

        
// Ocultar la lista al hacer clic fuera
document.addEventListener("click", (e) => {
  if (!notifList.classList.contains("hidden")) {
    if (!notifList.contains(e.target) && e.target !== notifBtn) {
      notifList.classList.add("hidden");
    }
  }
});

// --- MANEJO DE ELIMINACIÓN ---

// Variables para almacenar los datos del usuario
let currentAuthorName  = "";
let currentAuthorEmail = "";

// Función para obtener los datos de usuario de la URL o localStorage
function getUsuarioDataFromUrl() {
    const params = new URLSearchParams(window.location.search);
    const nameFromUrl = params.get("name");
    const emailFromUrl = params.get("email");

    if (nameFromUrl && emailFromUrl) {
        currentAuthorName  = nameFromUrl;
        currentAuthorEmail = emailFromUrl;
    } else {
        // Intentar obtener del localStorage
        const usuario = JSON.parse(localStorage.getItem("usuario"));
        if (usuario) {
            currentAuthorName  = usuario.nombre || "";
            currentAuthorEmail = usuario.correo || "";
        }
    }
}

// Llamar a la función al cargar la página
document.addEventListener("DOMContentLoaded", getUsuarioDataFromUrl);


// NUEVO: Variables para el modal de alerta personalizada
const customAlertModal = document.getElementById("custom-alert-modal");
const customAlertMessage = document.getElementById("custom-alert-message");
const customAlertOk = document.getElementById("custom-alert-ok");

// NUEVO: Función para mostrar el modal de alerta personalizado
function showAlert(message, title = "¡Atención!") {
    customAlertMessage.textContent = message;
    customAlertModal.querySelector('h3').textContent = title;
    customAlertModal.classList.remove("hidden");
}

// NUEVO: Ocultar el modal de alerta cuando se hace clic en "Aceptar"
customAlertOk.onclick = () => {
    customAlertModal.classList.add("hidden");
};

const btnDelete = document.getElementById("btn-delete");
const deleteModal = document.getElementById("delete-modal");
const deleteTitle = document.getElementById("delete-video-title");
const deleteConfirm = document.getElementById("delete-confirm");
const deleteCancel = document.getElementById("delete-cancel");

let pendingDelete = null;

btnDelete.onclick = () => {
    if (!swiper) return;
    const activeSlide = document.querySelector(".swiper-slide-active");
    if (!activeSlide) return;

    const title = activeSlide.dataset.title;
    const link = activeSlide.querySelector(".player-card")?.dataset.embed;

    // Si no hay datos de usuario, notificar y salir
    if (!currentAuthorName  || !currentAuthorEmail) {
        showAlert("No se pudo obtener la información de tu cuenta. Intenta recargar la página.");
        return;
    }

    pendingDelete = { title, link };
    deleteTitle.textContent = `¿Eliminar "${title}"?`;
    deleteModal.classList.remove("hidden");
};

deleteCancel.onclick = () => {
    deleteModal.classList.add("hidden");
    pendingDelete = null;
};

deleteConfirm.onclick = async () => {
    if (!pendingDelete) return;
    const { title, link } = pendingDelete;

    deleteModal.classList.add("hidden");
    pendingDelete = null;

    let identifier = "";
    let fileName = "";
    let archiveMatch = link.match(/archive\.org\/download\/([^/]+)\/(.+)$/);
    if (archiveMatch) {
        identifier = archiveMatch[1];
        fileName = decodeURIComponent(archiveMatch[2]);
    }
    
    const deleteUrl = `${SCRIPT_URL}?accion=eliminar&link=${encodeURIComponent(link)}&id=${encodeURIComponent(identifier)}&file=${encodeURIComponent(fileName)}&autor=${encodeURIComponent(currentAuthorName )}&correo=${encodeURIComponent(currentAuthorEmail)}`;

    try {
        const response = await fetch(deleteUrl);
        const data = await response.json();

        if (data.status === "success") {
            const activeIndex = swiper.activeIndex; // 👈 usar activeIndex real del DOM
            const activeSlide = swiper.slides[activeIndex];

            if (activeSlide) {
                activeSlide.remove();
                swiper.update();

                // Si hay slides, ir al mismo índice (que ahora apunta al siguiente inmediato)
                if (swiper.slides.length > 0) {
                    let targetIndex = Math.min(activeIndex, swiper.slides.length - 1);
                    swiper.slideTo(targetIndex, 0); // 👈 movimiento exacto
                }
            }

            showAlert("✅ Video eliminado con éxito.", "¡Listo!");
        } else {
            showAlert("❌ Error al eliminar: " + data.message, "Error");
        }
    } catch (err) {
        showAlert("⚠️ Error de conexión al intentar eliminar.", "Error");
    }
};




        
        let swiper = null;
        let players = {};

        function getEmbedInfo(link) {
            const url = new URL(link, location.href);
            if (url.hostname.includes("youtube.com") || url.hostname.includes("youtu.be")) {
                let videoId = "";
                if (url.hostname.includes("youtube.com")) {
                    videoId = url.searchParams.get("v") || "";
                } else if (url.hostname.includes("youtu.be")) {
                    videoId = url.pathname.replace("/", "");
                }
                if (videoId) {
                    const embedSrc = `https://www.youtube.com/embed/${videoId}?rel=0&playsinline=1&controls=0&modestbranding=1`;
                    const poster = "https://img.youtube.com/vi/" + videoId + "/hqdefault.jpg";
                    return { type: "youtube", embedSrc, poster, videoId };
                }
            }
            if (url.hostname.includes("archive.org")) {
                let identifier = "";
                const m = link.match(/archive\.org\/(?:embed|details|download)\/([^?&#/]+)/i);
                if (m && m[1]) {
                    identifier = m[1];
                }
                const poster = identifier ? `https://archive.org/services/img/${identifier}` : "";
                return { type: "mp4", embedSrc: link, poster: poster };
            }
            if (url.pathname.endsWith(".mp4")) {
                 return { type: "mp4", embedSrc: link, poster: "" };
            }
            return { type: "other", embedSrc: link, poster: "" };
        }

    function createSlide(titulo, link, descripcion, id) {
    const { embedSrc, poster } = getEmbedInfo(link);
    const slide = document.createElement("div");
    slide.className = "swiper-slide";
    slide.dataset.title = titulo || "Video";
    slide.dataset.descripcion = descripcion || "";
    slide.dataset.videoid = id || ""; // ← AGREGA EL ID ÚNICO AQUÍ

    const card = document.createElement("div");
    card.className = "player-card";
    card.dataset.embed = embedSrc;

    const posterEl = document.createElement("div");
    posterEl.className = "poster";
    if (poster) posterEl.style.backgroundImage = `url("${poster}")`;

    const playBtn = document.createElement("div");
    playBtn.className = "play-btn";
    playBtn.innerHTML = '<i class="fas fa-play"></i>';
    posterEl.appendChild(playBtn);

    posterEl.addEventListener("click", () => {
        mountIframe(card, true);
    });

    card.appendChild(posterEl);
    slide.appendChild(card);

    return slide;
}



        function mountIframe(cardEl, autoplay = true) {
  // 🔥 Antes de montar, desmonta todo lo demás
  cleanupIframesExceptActiveAndAdjacent();

  if (cardEl.querySelector("iframe") || cardEl.querySelector("video")) return;

  const src = cardEl.dataset.embed;
  const info = getEmbedInfo(src);

  const poster = cardEl.querySelector(".poster");
  if (poster) poster.remove();
  
  const controls = createControls();
  cardEl.appendChild(controls);

  const centerPlayPauseBtn = document.createElement("div");
  centerPlayPauseBtn.className = "center-play-pause-btn";
  centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
  cardEl.appendChild(centerPlayPauseBtn);
  
  let player;

  if (info.type === "youtube") {
    const container = document.createElement("div");
    container.className = "player-iframe";
    cardEl.appendChild(container);

    player = new YT.Player(container, {
      videoId: info.videoId,
      playerVars: { autoplay: autoplay ? 1 : 0, rel: 0, playsinline: 1, controls: 0, modestbranding: 1 },
      events: {
        onReady: (event) => {
          if (autoplay) event.target.playVideo();
          setupControls(event.target, 'youtube', controls, centerPlayPauseBtn, cardEl);
        },
        onStateChange: (event) => {
          const state = event.data;
          if (state === YT.PlayerState.PLAYING) {
            centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            centerPlayPauseBtn.style.opacity = 0;
          } else if (state === YT.PlayerState.PAUSED) {
            centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            centerPlayPauseBtn.style.opacity = 1;
          } else {
            centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
          }
        }
      }
    });
    players[src] = player;
  } else if (info.type === "mp4") {
    const video = document.createElement("video");
    video.className = "player-iframe";
    if (autoplay) video.setAttribute("autoplay", "true");
    video.setAttribute("playsinline", "true");
    video.style.width = "100%";
    video.style.height = "100%";
    video.style.background = "#000";

    const source = document.createElement("source");
    source.src = src;
    source.type = "video/mp4";
    video.appendChild(source);
    cardEl.appendChild(video);

    player = video;
    players[src] = player;

    video.addEventListener('loadedmetadata', () => {
      setupControls(video, 'mp4', controls, centerPlayPauseBtn, cardEl);
      if (!autoplay) video.pause();
    });
    video.addEventListener('play', () => {
      centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      centerPlayPauseBtn.style.opacity = 0;
    });
    video.addEventListener('pause', () => {
      centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      centerPlayPauseBtn.style.opacity = 1;
    });
    video.addEventListener('ended', () => {
      centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      centerPlayPauseBtn.style.opacity = 1;
    });
  } else {
    const iframe = document.createElement("iframe");
    iframe.className = "player-iframe";
    iframe.setAttribute("allow", "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share");
    iframe.setAttribute("allowfullscreen", "true");
    iframe.src = src + (src.includes("?") ? "&" : "?") + (autoplay ? "autoplay=1" : "");
    cardEl.appendChild(iframe);
  }
}

        
        function createControls() {
            const controlsBar = document.createElement("div");
            controlsBar.className = "controls-bar";

            const playPauseBtn = document.createElement("button");
            playPauseBtn.className = "play-pause-btn";
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';

            const progressBarContainer = document.createElement("div");
            progressBarContainer.className = "progress-bar";
            const progress = document.createElement("div");
            progress.className = "progress";
            progressBarContainer.appendChild(progress);

            const timeDisplay = document.createElement("div");
            timeDisplay.className = "time";
            timeDisplay.textContent = "00:00 / 00:00";

            const volumeControl = document.createElement("div");
            volumeControl.className = "volume-control";
            const volumeIcon = document.createElement("span");
            volumeIcon.className = "volume-icon";
            volumeIcon.innerHTML = '<i class="fas fa-volume-up"></i>';
            const volumeSlider = document.createElement("input");
            volumeSlider.type = "range";
            volumeSlider.min = "0";
            volumeSlider.max = "1";
            volumeSlider.step = "0.01";
            volumeSlider.value = "1";
            volumeControl.appendChild(volumeIcon);
            volumeControl.appendChild(volumeSlider);

            controlsBar.appendChild(playPauseBtn);
            controlsBar.appendChild(progressBarContainer);
            controlsBar.appendChild(timeDisplay);
            controlsBar.appendChild(volumeControl);

            return controlsBar;
        }

function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return [h, m, s]
                .filter(v => v > 0 || v === 0)
                .map(v => v.toString().padStart(2, '0'))
                .join(':')
                .replace(/^00:/, '');
        }

        function setupControls(player, type, controls, centerPlayPauseBtn, cardEl) {
            const playPauseBtn = controls.querySelector('.play-pause-btn');
            const progressBarContainer = controls.querySelector('.progress-bar');
            const progress = controls.querySelector('.progress');
            const volumeSlider = controls.querySelector('.volume-control input');
            const timeDisplay = controls.querySelector('.time');
            let totalTime = 0;
            let timeoutId;
            
            const hideControls = () => {
                controls.style.opacity = 0;
                if (type === 'youtube' && player.getPlayerState() === YT.PlayerState.PLAYING) {
                    centerPlayPauseBtn.style.opacity = 0;
                } else if (type === 'mp4' && !player.paused) {
                    centerPlayPauseBtn.style.opacity = 0;
                }
            };
            
            const showControls = () => {
                clearTimeout(timeoutId);
                controls.style.opacity = 1;
                centerPlayPauseBtn.style.opacity = 1;
                timeoutId = setTimeout(hideControls, 3000);
            };

            const updateTime = () => {
                let currentTime = 0;
                if (type === 'youtube') {
                    currentTime = player.getCurrentTime();
                } else {
                    currentTime = player.currentTime;
                }
                const progressPercentage = (currentTime / totalTime) * 100;
                progress.style.width = `${progressPercentage}%`;
                timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(totalTime)}`;
            };

            const interval = setInterval(updateTime, 1000);

            cardEl.addEventListener('mouseenter', showControls);
            cardEl.addEventListener('mouseleave', hideControls);
            cardEl.addEventListener('mousemove', showControls);
            
            if (type === 'youtube') {
                totalTime = player.getDuration();
                updateTime();
                playPauseBtn.onclick = () => {
                    const state = player.getPlayerState();
                    if (state === YT.PlayerState.PLAYING) {
                        player.pauseVideo();
                    } else {
                        player.playVideo();
                    }
                };
                centerPlayPauseBtn.onclick = playPauseBtn.onclick;

                progressBarContainer.onclick = (e) => {
                    const clickX = e.offsetX;
                    const totalWidth = progressBarContainer.clientWidth;
                    const newTime = (clickX / totalWidth) * totalTime;
                    player.seekTo(newTime, true);
                };
                volumeSlider.oninput = (e) => player.setVolume(e.target.value * 100);
            } else if (type === 'mp4') {
                totalTime = player.duration;
                updateTime();
                playPauseBtn.onclick = () => {
                    if (player.paused) {
                        player.play();
                    } else {
                        player.pause();
                    }
                };
                centerPlayPauseBtn.onclick = playPauseBtn.onclick;
                progressBarContainer.onclick = (e) => {
                    const clickX = e.offsetX;
                    const totalWidth = progressBarContainer.clientWidth;
                    const newTime = (clickX / totalWidth) * totalTime;
                    player.currentTime = newTime;
                };
                volumeSlider.oninput = (e) => player.volume = e.target.value;
                player.addEventListener('timeupdate', updateTime);
            }
        }

        function restorePoster(card) {
            const src = card.dataset.embed;
            const player = players[src];
            if (player) {
                if (typeof player.pauseVideo === 'function') {
                    player.pauseVideo();
                } else if (typeof player.pause === 'function') {
                    player.pause();
                }
            }

            const playerContainer = card.querySelector(".player-iframe");
            if (playerContainer) playerContainer.remove();

            const controlsBar = card.querySelector(".controls-bar");
            if (controlsBar) controlsBar.remove();
            
            const centerBtn = card.querySelector(".center-play-pause-btn");
            if (centerBtn) centerBtn.remove();

            if (!card.querySelector(".poster")) {
                const info = getEmbedInfo(src);
                const posterEl = document.createElement("div");
                posterEl.className = "poster";
                if (info.poster) {
                    posterEl.style.backgroundImage = `url("${info.poster}")`;
                }
                const playBtn = document.createElement("div");
                playBtn.className = "play-btn";
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                posterEl.appendChild(playBtn);
                posterEl.addEventListener("click", () => mountIframe(card, true));
                card.appendChild(posterEl);
            }
        }

        // --- INICIO DE LA CORRECCIÓN ---
function cleanupIframesExceptActiveAndAdjacent() {
    if (!swiper) return;

    const activeIndex = swiper.activeIndex;
    const prevIndex = (activeIndex - 1 + swiper.slides.length) % swiper.slides.length;
    const nextIndex = (activeIndex + 1) % swiper.slides.length;

    swiper.slides.forEach((slide, index) => {
        if (index !== activeIndex && index !== prevIndex && index !== nextIndex) {
            const card = slide.querySelector(".player-card");
            if (card) {
                const src = card.dataset.embed;
                const player = players[src];
                if (player) {
                    if (typeof player.pauseVideo === 'function') player.pauseVideo();
                    else if (typeof player.pause === 'function') player.pause();
                    delete players[src]; // Limpiar el reproductor de la memoria
                }
                restorePoster(card); // Restaurar el póster solo para slides no adyacentes
            }
        } else if (index !== activeIndex) {
            // Para prev y next, pausar si está reproduciendo, pero mantener el iframe/video
            const card = slide.querySelector(".player-card");
            if (card) {
                const src = card.dataset.embed;
                const player = players[src];
                if (player) {
                    if (typeof player.pauseVideo === 'function') player.pauseVideo();
                    else if (typeof player.pause === 'function') player.pause();
                    // Actualizar botón central para slides adyacentes
                    const centerPlayPauseBtn = card.querySelector('.center-play-pause-btn');
                    if (centerPlayPauseBtn) {
                        centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        centerPlayPauseBtn.style.opacity = 1;
                    }
                }
            }
        }
    });
}

        // --- FIN DE LA CORRECCIÓN ---

   function updateFixedTitle(swiperInstance) {
    const fixedBox = document.getElementById("video-title-fixed");
    if (!fixedBox || !swiperInstance) return;

    const activeSlide = swiperInstance.slides[swiperInstance.activeIndex] || document.querySelector('.swiper-slide-active');
    if (!activeSlide) return;

    const newTitle = activeSlide.dataset.title || "Video";
    const newDesc = activeSlide.dataset.descripcion || "";

    const titleEl = fixedBox.querySelector(".video-title");
    const descEl = fixedBox.querySelector(".video-desc");

    const currentTitle = titleEl.querySelector('.text-container')?.textContent;
    const currentDesc = descEl.querySelector('.text-container')?.textContent;
    
    if (currentTitle === newTitle && currentDesc === newDesc) {
        return;
    }

    fixedBox.style.opacity = 0;

    setTimeout(() => {
        const setupExpandableText = (element, text, allowExpand = true) => {
            // ✅ limpiar cualquier rastro previo (importante en la primera carga)
            element.innerHTML = "";
            
            const container = document.createElement("span");
            container.className = "text-container";
            container.textContent = text;
            element.appendChild(container);

            setTimeout(() => {
                if (!allowExpand) return; // 👈 el título no se expande

                // crear copia para medir sin clamp
                const temp = container.cloneNode(true);
                temp.style.display = "inline-block";
                temp.style.webkitLineClamp = "unset";
                temp.style.maxHeight = "none";
                temp.style.visibility = "hidden";
                element.appendChild(temp);

                const needsClamp = temp.scrollHeight > container.clientHeight;
                temp.remove();

                if (needsClamp) {
                    // ✅ asegurar que no se dupliquen botones
                    element.querySelectorAll(".toggle-text").forEach(btn => btn.remove());

                    const toggleButton = document.createElement("span");
                    toggleButton.className = "toggle-text";
                    toggleButton.textContent = "...más";
                    element.appendChild(toggleButton);

                    const toggleExpand = () => {
                        const isExpanded = container.classList.contains("expanded");
                        if (isExpanded) {
                            container.classList.remove("expanded");
                            toggleButton.textContent = "...más";
                        } else {
                            container.classList.add("expanded");
                            toggleButton.textContent = "mostrar menos";
                        }
                    };

                    // clic en el botón o en el contenedor
                    toggleButton.addEventListener("click", (e) => {
                        e.stopPropagation();
                        toggleExpand();
                    });
                    container.addEventListener("click", (e) => {
                        e.stopPropagation();
                        toggleExpand();
                    });
                }
            }, 50);
        };

        setupExpandableText(titleEl, newTitle, false); // 👈 título siempre completo
        setupExpandableText(descEl, newDesc, true);   // 👈 descripción expandible

        fixedBox.style.opacity = 1;
    }, 120);
}



        


async function cargarVideos(checkNew = false) {
  const loader = document.getElementById("loader");
  if (!loader) {
    console.error("❌ Error: Elemento loader no encontrado en el DOM");
    return;
  }
  if (!checkNew) loader.style.display = "flex";

  try {
    const res = await fetch(`${SCRIPT_URL}?accion=listar&tipo=videos`);
    const data = await res.json();

    const wrapper = document.getElementById("slides");
    if (!wrapper) {
      console.error("❌ Error: Contenedor de slides no encontrado");
      loader.style.display = "none";
      return;
    }
    if (!checkNew) wrapper.innerHTML = "";

    let newVideos = [];
    if (Array.isArray(data.data)) {
      data.data.forEach((row) => {
        const titulo = row[0];
        const link = row[1];
        const descripcion = row[4] || "";
        const id = row[5];
        if (titulo && link && id) { // 🔥 FIX8: Validar datos para evitar videos inválidos
          newVideos.push({ title: titulo, link, desc: descripcion, id });
        }
      });
    } else {
      console.warn("⚠️ Advertencia: No se recibieron datos válidos de videos");
    }

    // ⚡ Precargamos primero los comentarios del PRIMER video
    if (!checkNew && newVideos.length > 0) {
      const primerVideoId = newVideos[0].id;
      await cargarComentarios(primerVideoId, true);
      console.log("✅ Comentarios del primer video cargados");

      const videosRestantes = newVideos.slice(1);
      if (videosRestantes.length > 0) {
        Promise.all(videosRestantes.map(v => cargarComentarios(v.id, false)))
          .catch(e => console.warn("Error precargando comentarios:", e));
      }
    }

    // ⚡ Mostramos los videos
    if (!checkNew) {
      newVideos.forEach(v => {
        wrapper.appendChild(createSlide(v.title, v.link, v.desc, v.id));
      });
    }

    // 🔥 FIX8: Eliminación silenciosa sin afectar slide activo
    if (checkNew) {
      const linksActivos = newVideos.map(v => v.link);
      const activeSlide = document.querySelector('.swiper-slide-active');
      const activeLink = activeSlide ? activeSlide.querySelector('.player-card')?.dataset.embed : null;
      
      Array.from(wrapper.children).forEach(slide => {
        const card = slide.querySelector(".player-card");
        if (card && !linksActivos.includes(card.dataset.embed)) {
          if (slide === activeSlide) {
            // 🔥 FIX8: Si el slide eliminado es el activo, pasar al siguiente slide
            if (swiper) {
              swiper.removeSlide(swiper.activeIndex);
              console.log("✅ Slide activo eliminado, pasando al siguiente");
              swiper.slideNext(0); // Transición inmediata al siguiente slide
            }
          } else {
            // 🔥 FIX8: Eliminar solo slides no activos, sin actualizar Swiper inmediatamente
            wrapper.removeChild(slide);
            console.log("✅ Slide no activo eliminado silenciosamente");
          }
        }
      });
      // 🔥 FIX8: Actualizar Swiper solo después de todas las eliminaciones
      if (swiper) {
        swiper.update();
        console.log("✅ Swiper actualizado tras eliminación");
      }
    }

    // 🛎️ Notificaciones de nuevos videos
    if (checkNew && lastVideos.length > 0) { 
      const nuevos = newVideos.filter(v => !lastVideos.find(old => old.link === v.link));
      if (nuevos.length > 0) {
        // 🔥 FIX8: Filtrar notificaciones vacías/inválidas antes de añadir
        const validNuevos = nuevos.filter(v => v.title && v.link && v.id);
        if (validNuevos.length > 0) {
          notifications.unshift(...validNuevos);
          renderNotifications();
          console.log(`✅ ${validNuevos.length} nuevas notificaciones válidas añadidas`);
        } else {
          console.warn("⚠️ No se añadieron notificaciones: datos inválidos");
        }
      }
    }

    lastVideos = newVideos;

    // ✅ Inicializamos Swiper
  // Dentro de cargarVideos, reemplaza el bloque de inicialización de Swiper con este:
// Reemplaza solo el bloque de inicialización de Swiper dentro de cargarVideos
// Reemplaza solo el bloque de inicialización de Swiper dentro de cargarVideos
if (!checkNew) {
    if (swiper) swiper.destroy(true, true);
    swiper = new Swiper(".swiper", {
        loop: true,
        direction: "vertical",
        slidesPerView: 1,
        spaceBetween: 10,
        pagination: false,
        on: {
            init() {
                updateFixedTitle(this);
                activarSwipeParaBorrar();
                const videoId = getActiveVideoId();
                if (videoId) renderComentarios(videoId);
                console.log("✅ Swiper inicializado");
                // Inicializar el primer video con reproducción automática
                const activeCard = this.slides[this.activeIndex].querySelector('.player-card');
                if (activeCard && !activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                    mountIframe(activeCard, true);
                }
            },
            slideChange() {
                cleanupIframesExceptActiveAndAdjacent();
                updateFixedTitle(this);
                activarSwipeParaBorrar();
                const videoId = getActiveVideoId();
                if (videoId) {
                    if (!comentariosPorVideo[videoId]) {
                        cargarComentarios(videoId, true);
                    } else {
                        renderComentarios(videoId);
                    }
                }
            },
            slideChangeTransitionEnd() {
                updateFixedTitle(this);
                const activeIndex = this.activeIndex;
                const prevIndex = (activeIndex - 1 + this.slides.length) % this.slides.length;
                const nextIndex = (activeIndex + 1) % this.slides.length;

                // Manejar active
                const activeCard = this.slides[activeIndex].querySelector('.player-card');
                if (activeCard) {
                    const src = activeCard.dataset.embed;
                    if (!activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                        mountIframe(activeCard, true); // Montar con reproducción automática
                    } else {
                        const player = players[src];
                        if (player) {
                            // Asegurar que el video activo se reproduzca
                            if (typeof player.playVideo === 'function') {
                                player.playVideo();
                            } else if (typeof player.play === 'function') {
                                player.play().catch(e => console.warn("Error al reproducir:", e));
                            }
                            // Actualizar estado del botón central
                            const centerPlayPauseBtn = activeCard.querySelector('.center-play-pause-btn');
                            if (centerPlayPauseBtn) {
                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                centerPlayPauseBtn.style.opacity = 0;
                            }
                        }
                    }
                }

                // Precargar prev
                const prevCard = this.slides[prevIndex].querySelector('.player-card');
                if (prevCard && !prevCard.querySelector("iframe") && !prevCard.querySelector("video")) {
                    mountIframe(prevCard, false); // Precargar sin reproducir
                } else if (prevCard) {
                    const centerPlayPauseBtn = prevCard.querySelector('.center-play-pause-btn');
                    if (centerPlayPauseBtn) {
                        centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        centerPlayPauseBtn.style.opacity = 1;
                    }
                }

                // Precargar next
                const nextCard = this.slides[nextIndex].querySelector('.player-card');
                if (nextCard && !nextCard.querySelector("iframe") && !nextCard.querySelector("video")) {
                    mountIframe(nextCard, false); // Precargar sin reproducir
                } else if (nextCard) {
                    const centerPlayPauseBtn = nextCard.querySelector('.center-play-pause-btn');
                    if (centerPlayPauseBtn) {
                        centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        centerPlayPauseBtn.style.opacity = 1;
                    }
                }

                const videoId = getActiveVideoId();
                if (videoId && comentariosPorVideo[videoId]) {
                    renderComentarios(videoId);
                }
            }
        },
    });

    cleanupIframesExceptActiveAndAdjacent();
    updateFixedTitle(swiper);
    activarSwipeParaBorrar();
    const videoId = getActiveVideoId();
    if (videoId) renderComentarios(videoId);
}
  } catch (e) {
    console.error("❌ Error cargando videos:", e);
  } finally {
    loader.style.display = "none";
  }
}



        
     function activarSwipeParaBorrar() {
  let swipeInfo = null;

  commentsList.addEventListener('touchstart', (e) => {
    const commentElement = e.target.closest('li');
    if (!commentElement) return;
    const commentData = commentElement.dataset;

    if (normalizeText(commentData.correo) === normalizeText(currentAuthorEmail)) {
      startX = e.touches[0].clientX;
      activeComment = commentElement;
      activeComment.querySelector('.comment-content').style.transition = 'none';
      isSwiping = false;
    }
  });

  commentsList.addEventListener('touchmove', (e) => {
    if (!activeComment) return;
    const currentX = e.touches[0].clientX;
    const diffX = currentX - startX;

    if (Math.abs(diffX) > 10) isSwiping = true;

    const commentContent = activeComment.querySelector('.comment-content');
    const deleteBtnContainer = activeComment.querySelector('.delete-btn-container');

    if (diffX > 0) {
      commentContent.style.transform = `translateX(${diffX}px)`;
      if (deleteBtnContainer) deleteBtnContainer.style.transform = `translateX(0)`;
    } else {
      commentContent.style.transform = `translateX(0)`;
      if (deleteBtnContainer) deleteBtnContainer.style.transform = `translateX(-100%)`;
    }
  });

  commentsList.addEventListener('touchend', (e) => {
    if (!activeComment) return;
    const swipeThreshold = 50;
    const diffX = e.changedTouches[0].clientX - startX;

    const commentContent = activeComment.querySelector('.comment-content');
    let deleteBtnContainer = activeComment.querySelector('.delete-btn-container');
    commentContent.style.transition = 'transform 0.3s ease';

    if (diffX > swipeThreshold) {
      // Mantén el botón visible y marca como swiped
      commentContent.classList.add('swiped');
      activeComment.classList.add('swiped');
      commentContent.style.transform = `translateX(100px)`;

      swipeInfo = {
        texto: activeComment.dataset.texto,
        correo: activeComment.dataset.correo
      };

      if (!deleteBtnContainer) {
        deleteBtnContainer = document.createElement('div');
        deleteBtnContainer.className = 'delete-btn-container visible';
        const deleteBtn = document.createElement('div');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Borrar';
        deleteBtnContainer.appendChild(deleteBtn);
        activeComment.insertBefore(deleteBtnContainer, commentContent);

        deleteBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          eliminarComentario(getActiveVideoId(), activeComment.dataset.texto, activeComment.dataset.correo);
          // Quita el swipe tras borrar
          commentContent.classList.remove('swiped');
          activeComment.classList.remove('swiped');
          commentContent.style.transform = `translateX(0)`;
          deleteBtnContainer.classList.remove('visible');
          deleteBtnContainer.style.transform = `translateX(-100%)`;
          swipeInfo = null;
          activeComment = null;
        });
      } else {
        deleteBtnContainer.classList.add('visible');
        deleteBtnContainer.style.transform = `translateX(0)`;
      }
    } else {
      // Solo regresa si no fue swipe suficiente
      commentContent.classList.remove('swiped');
      activeComment.classList.remove('swiped');
      commentContent.style.transform = `translateX(0)`;
      if (deleteBtnContainer) {
        deleteBtnContainer.classList.remove('visible');
        deleteBtnContainer.style.transform = `translateX(-100%)`;
      }
      swipeInfo = null;
      activeComment = null;
    }
    startX = 0;
  });

  // === Oculta el botón Borrar al tocar fuera del comentario swiped ===
  document.addEventListener('touchstart', (e) => {
    // Si el target NO está dentro de un comentario swiped, quita el swipe
    const swiped = document.querySelector('li.swiped');
    const isDeleteBtn = e.target.classList.contains('delete-btn');
    if (swiped && !swiped.contains(e.target) && !isDeleteBtn) {
      const commentContent = swiped.querySelector('.comment-content');
      const deleteBtnContainer = swiped.querySelector('.delete-btn-container');
      if (commentContent) {
        commentContent.classList.remove('swiped');
        commentContent.style.transform = `translateX(0)`;
      }
      if (deleteBtnContainer) {
        deleteBtnContainer.classList.remove('visible');
        deleteBtnContainer.style.transform = `translateX(-100%)`;
      }
      swiped.classList.remove('swiped');
      swipeInfo = null;
      activeComment = null;
    }
  });

  // === Restaurar swipe tras renderComentarios ===
  // Debes modificar renderComentarios para incluir este fragmento al final:
  window.restoreSwipeAfterRender = function() {
    if (!swipeInfo) return;
    const commentsList = document.getElementById('commentsList');
    if (!commentsList) return;
    const lis = commentsList.querySelectorAll('li');
    lis.forEach(li => {
      if (
        normalizeText(li.dataset.correo) === normalizeText(swipeInfo.correo) &&
        li.dataset.texto === swipeInfo.texto
      ) {
        li.classList.add('swiped');
        const commentContent = li.querySelector('.comment-content');
        if (commentContent) {
          commentContent.classList.add('swiped');
          commentContent.style.transform = `translateX(100px)`;
        }
        const deleteBtnContainer = li.querySelector('.delete-btn-container');
        if (deleteBtnContainer) {
          deleteBtnContainer.classList.add('visible');
          deleteBtnContainer.style.transform = `translateX(0)`;
        }
      }
    });
  };
}

// === AUTO REFRESCO EN SEGUNDO PLANO ===
setInterval(() => {
  cargarVideos(true); // solo refresca notificaciones, no toca el sliderF
}, 3000);

        cargarVideos();
    </script>
</body>
</html>































